#include "stdint.h"
#include "math.h"
#define COMMA	  0x2C

unsigned char  charRead;	     		/* char read from COM port */
unsigned char  stringdata[100]; 		/* Buffer collects chars read from GPS */
unsigned char  tempString[100];
unsigned char  latitudeString[11];
//unsigned char  latitudeCardinalString[3];
unsigned char  longitudeString[12];
//unsigned char  longitudeCardinalString[3];

unsigned char  *pChar;
//unsigned char  dummyChar;

unsigned  char lastCommaPosition;

  float latitude;
  int   latDegrees;
  float	latMinutes;

  float longitude;
  int	  longDegrees;
  float longMinutes;

void SystemInit(void){}
	
	
float latitude_longitude(char arr[], int size){

 
unsigned int   j, k;				/* dummy variable */
//unsigned int	 i;		     		/* Number of chars read per GPS message string */

//dummyChar = 'A'; pChar = &dummyChar;

      j = 0;
	  pChar = stringdata;
	  while(*(pChar+j) != COMMA) {
	       tempString[j] = *(pChar+j);
	       j++;
	  }
	  tempString[j] = '\0';

if(tempString[3] == 'R' && tempString[4] == 'M' && tempString[5] == 'C') {
   if (tempString[17] == 'A'){   //TO CHECK GPS FIX
       // pChar = stringRead;
  
/* Get lattitude: ddmm.mmmm */
	      pChar = stringdata;
	      j = 19;
	      k = 0;
	      while(*(pChar+j) != COMMA) {
		    latitudeString[k] = *(pChar+j);
		    j++;
		    k++;
	      }
	      lastCommaPosition = j;
	      latitudeString[k] = '\0';

	      sscanf(latitudeString, "%f", &latitude);
	      latDegrees = (int)(latitude/100);
	      latMinutes = (float)((latitude - latDegrees*100)/60);
			  latitude = latDegrees + latMinutes;
	      //printf("/t%02d DEG/t%2.4f MIN", latDegrees, latMinutes);

//	      /* Get lattitude Cardinal direction */
//	      pChar = stringRead;
//	      j = lastCommaPosition + 1;
//	      k = 0;
//	      while(*(pChar+j) != COMMA) {
//		    latitudeCardinalString[k] = *(pChar+j);
//		    j++;
//		    k++;
//	      }
//	      lastCommaPosition = j;
//	      latitudeCardinalString[k] = '\0';
//	      //printf(" %s", latitudeCardinalString);

	      /* Get longitude: dddmm.mmmm */
	      pChar = stringdata;
	      //j = lastCommaPosition + 1;
				j=32;
	      k = 0;
	      while(*(pChar+j) != COMMA) {
		    longitudeString[k] = *(pChar+j);
		    j++;
		    k++;
	      }
	      lastCommaPosition = j;
	      longitudeString[k] = '\0';

	      sscanf(longitudeString, "%f", &longitude);
	      longDegrees = (int)(longitude/100);
	      longMinutes = (float)((longitude - longDegrees*100)/60);
		    longitude = longDegrees + longMinutes;
	 
	      }
    return longitude;
    return latitude;
}
}

//to write in the main:

int main(){
	while(1)
	{
//    readmsg();
//		latitude_longitude(stringdata[],MAX);
  }
}
